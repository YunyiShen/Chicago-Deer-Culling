source(file.choose())
require(ggplot2)
load("/media/yunyi/Academia/UW Lab jobs/3. Lislie Reconstruction/DDLeslie_package/Chicago_scheme/Population_simulation_scheme/4harv_8fec_6surv_equal.RData")
# Just for plotting things
period = 15
## Harvest prediction
mean.harv = apply(Chicago_RES$mcmc.objs$H.mcmc,2,mean)
mean.harv.matrix = matrix(mean.harv,nrow = sum(nage),ncol = period)
mean.total.harv = apply(mean.harv.matrix,2,sum)
## Harvest prediction
mean.harv = apply(Chicago_RES$mcmc.objs$H.mcmc,2,mean)
mean.harv
period
68/14
68/16
dim(Chicago_RES$mcmc.objs$H.mcmc)
68/17
# Just for plotting things
period = 17
## Harvest prediction
mean.harv = apply(Chicago_RES$mcmc.objs$H.mcmc,2,mean)
mean.harv.matrix = matrix(mean.harv,nrow = sum(nage),ncol = period)
## Harvest prediction
mean.harv = apply(Chicago_RES$mcmc.objs$H.mcmc,2,mean)
mean.harv.matrix = matrix(mean.harv,ncol = period)
mean.total.harv = apply(mean.harv.matrix,2,sum)
plot(mean.total.harv)
mean.harv.mean = data.frame(age = c(paste0("F",1:2),paste0("M",1:2)), mean.harv.matrix)
BI.low.harv = apply(Chicago_RES$mcmc.objs$H.mcmc,2,quantile,probs = .025)
BI.low.harv.matrix = matrix(BI.low.harv,ncol = period)
BI_harv_low = data.frame(age = c(paste0("F",1:2),paste0("M",1:2)),BI.low.harv.matrix)
BI.high.harv.matrix = matrix(BI.high.harv,ncol = period)
BI.high.harv = apply(Chicago_RES$mcmc.objs$H.mcmc,2,quantile,probs = .975)
BI.high.harv.matrix = matrix(BI.high.harv,ncol = period)
BI_harv_high = data.frame(age = c(paste0("F",1:8),paste0("M",1:3)),BI.high.harv.matrix)
BI.high.harv = apply(Chicago_RES$mcmc.objs$H.mcmc,2,quantile,probs = .975)
BI.high.harv.matrix = matrix(BI.high.harv,ncol = period)
BI_harv_high = data.frame(age = c(paste0("F",1:2),paste0("M",1:2)),BI.high.harv.matrix)
har_data = data.frame(matrix(nrow = 1,ncol = 5))
colnames(har_data) = c("age","mean","low","high","time")
har_data = har_data[-1,]
require(ggplot2)
2006-1992+1
age_code <- c("FF","FA","MF","MA")
temp1 = data.frame(point = "model predict (95% CI)",mean = mean.harv.matrix[i,],low = BI.low.harv.matrix[i,],high = BI.high.harv.matrix[i,],time = 1992:2008, age_code = age_code[1])
temp1 = data.frame(point = "model predict (95% CI)",mean = mean.harv.matrix[1,],low = BI.low.harv.matrix[i,],high = BI.high.harv.matrix[i,],time = 1992:2008, age_code = age_code[1])
temp1 = data.frame(point = "model predict (95% CI)",mean = mean.harv.matrix[1,],low = BI.low.harv.matrix[1,],high = BI.high.harv.matrix[1,],time = 1992:2008, age_code = age_code[1])
temp1
all_summary = data.frame(point = "model predict (95% CI)",mean = mean.harv.matrix[1,],low = BI.low.harv.matrix[1,],high = BI.high.harv.matrix[1,],time = 1992:2008, age_code = age_code[1])
for(i in 2:4){
temp1 = data.frame(point = "model predict (95% CI)",mean = mean.harv.matrix[i,],low = BI.low.harv.matrix[i,],high = BI.high.harv.matrix[i,],time = 1992:2008, age_code = age_code[i])
all_summary <- rbind(temp1,all_summary)
#temp2 = data.frame(point = "data",mean = t(Harv.data[i,1:15]),low =t( Harv.data[i,1:15]),high = t(Harv.data[i,1:15]),time = 1992:2008)
#colnames(temp2) = colnames(temp1)
#temp = rbind(temp1,temp2)
#write.csv(temp,paste0("./figs/temp/",BI_harv_high$age[i],".csv"))
#rm(temp1)
#rm(temp2)
#filename = paste0("./figs/temp/",BI_harv_high$age[i],".jpg")
#ggplot(data.frame(temp),aes(x=time, y=mean, colour = point)) +
#  geom_errorbar(aes(ymin=low, ymax=high), width=.1) +
#  geom_point()
#ggsave(filename, plot = last_plot())
}
all_summary
all_summary = data.frame(harvest.rate = mean.harv.matrix[1,],low = BI.low.harv.matrix[1,],high = BI.high.harv.matrix[1,],time = 1992:2008, age_code = age_code[1])
for(i in 2:4){
temp1 = data.frame(harvest.rate  = mean.harv.matrix[i,],low = BI.low.harv.matrix[i,],high = BI.high.harv.matrix[i,],time = 1992:2008, age_code = age_code[i])
all_summary <- rbind(temp1,all_summary)
#temp2 = data.frame(point = "data",mean = t(Harv.data[i,1:15]),low =t( Harv.data[i,1:15]),high = t(Harv.data[i,1:15]),time = 1992:2008)
#colnames(temp2) = colnames(temp1)
#temp = rbind(temp1,temp2)
#write.csv(temp,paste0("./figs/temp/",BI_harv_high$age[i],".csv"))
#rm(temp1)
#rm(temp2)
#filename = paste0("./figs/temp/",BI_harv_high$age[i],".jpg")
#ggplot(data.frame(temp),aes(x=time, y=mean, colour = point)) +
#  geom_errorbar(aes(ymin=low, ymax=high), width=.1) +
#  geom_point()
#ggsave(filename, plot = last_plot())
}
head(all_summary)
all_summary[,1:3] <- 1/(1+exp(-all_summary[,1:3]))
head(all_summary)
ggplot(data = all_summary, aes(x=time,y=harvest.rate,col = age_code))+
geom_line()
Chicago_RES$mcmc.objs$harvest.mcmc[1,1]
Chicago_RES$mcmc.objs$survival.mcmc[1,1]
dim(Chicago_RES$mcmc.objs$H.mcmc)
mean.harv.matrix
mean.harv.matrix = matrix(mean.harv,ncol = period,byrow = T)
matplot(mean.harv.matrix)
matplot(t(mean.harv.matrix))
matplot(t(mean.harv.matrix),type="l")
## Harvest prediction
mean.harv = apply(Chicago_RES$mcmc.objs$H.mcmc,2,mean)
mean.harv.matrix = matrix(mean.harv,ncol = period)
mean.harv.mean = data.frame(age = c(paste0("F",1:2),paste0("M",1:2)), mean.harv.matrix, byrow=T)
## Harvest prediction
mean.harv = apply(Chicago_RES$mcmc.objs$H.mcmc,2,mean)
mean.harv.matrix = matrix(mean.harv,ncol = period)
mean.harv.mean = data.frame(age = c(paste0("F",1:2),paste0("M",1:2)), mean.harv.matrix, byrow=T)
BI.low.harv = apply(Chicago_RES$mcmc.objs$H.mcmc,2,quantile,probs = .025)
BI.low.harv.matrix = matrix(BI.low.harv,ncol = period, byrow = T)
BI_harv_low = data.frame(age = c(paste0("F",1:2),paste0("M",1:2)),BI.low.harv.matrix)
BI.high.harv = apply(Chicago_RES$mcmc.objs$H.mcmc,2,quantile,probs = .975)
BI.high.harv.matrix = matrix(BI.high.harv,ncol = period, byrow = T)
BI_harv_high = data.frame(age = c(paste0("F",1:2),paste0("M",1:2)),BI.high.harv.matrix)
har_data = data.frame(matrix(nrow = 1,ncol = 5))
colnames(har_data) = c("age","mean","low","high","time")
har_data = har_data[-1,]
age_code <- c("FF","FA","MF","MA")
require(ggplot2)
all_summary = data.frame(harvest.rate = mean.harv.matrix[1,],low = BI.low.harv.matrix[1,],high = BI.high.harv.matrix[1,],time = 1992:2008, age_code = age_code[1])
for(i in 2:4){
temp1 = data.frame(harvest.rate  = mean.harv.matrix[i,],low = BI.low.harv.matrix[i,],high = BI.high.harv.matrix[i,],time = 1992:2008, age_code = age_code[i])
all_summary <- rbind(temp1,all_summary)
}
all_summary[,1:3] <- 1/(1+exp(-all_summary[,1:3]))
ggplot(data = all_summary, aes(x=time,y=harvest.rate,col = age_code))+
geom_line()
plot(mean.harv.mean[1,])
plot(mean.harv.matrix[1,])
## Harvest prediction
mean.harv = apply(Chicago_RES$mcmc.objs$H.mcmc,2,mean)
mean.harv.matrix = matrix(mean.harv,ncol = period, byrow=T)
mean.harv.mean = data.frame(age = c(paste0("F",1:2),paste0("M",1:2)), mean.harv.matrix)
BI.low.harv = apply(Chicago_RES$mcmc.objs$H.mcmc,2,quantile,probs = .025)
BI.low.harv.matrix = matrix(BI.low.harv,ncol = period, byrow = T)
BI_harv_low = data.frame(age = c(paste0("F",1:2),paste0("M",1:2)),BI.low.harv.matrix)
BI.high.harv = apply(Chicago_RES$mcmc.objs$H.mcmc,2,quantile,probs = .975)
BI.high.harv.matrix = matrix(BI.high.harv,ncol = period, byrow = T)
BI_harv_high = data.frame(age = c(paste0("F",1:2),paste0("M",1:2)),BI.high.harv.matrix)
har_data = data.frame(matrix(nrow = 1,ncol = 5))
colnames(har_data) = c("age","mean","low","high","time")
har_data = har_data[-1,]
age_code <- c("FF","FA","MF","MA")
require(ggplot2)
all_summary = data.frame(harvest.rate = mean.harv.matrix[1,],low = BI.low.harv.matrix[1,],high = BI.high.harv.matrix[1,],time = 1992:2008, age_code = age_code[1])
for(i in 2:4){
temp1 = data.frame(harvest.rate  = mean.harv.matrix[i,],low = BI.low.harv.matrix[i,],high = BI.high.harv.matrix[i,],time = 1992:2008, age_code = age_code[i])
all_summary <- rbind(temp1,all_summary)
}
all_summary[,1:3] <- 1/(1+exp(-all_summary[,1:3]))
ggplot(data = all_summary, aes(x=time,y=harvest.rate,col = age_code))+
geom_line()
age_code <- c("Female.Fawn","Female.Adult","Male.Fawn","Male.Adult")
require(ggplot2)
all_summary = data.frame(harvest.rate = mean.harv.matrix[1,],low = BI.low.harv.matrix[1,],high = BI.high.harv.matrix[1,],time = 1992:2008, age_code = age_code[1])
for(i in 2:4){
temp1 = data.frame(harvest.rate  = mean.harv.matrix[i,],low = BI.low.harv.matrix[i,],high = BI.high.harv.matrix[i,],time = 1992:2008, age_code = age_code[i])
all_summary <- rbind(temp1,all_summary)
}
all_summary[,1:3] <- 1/(1+exp(-all_summary[,1:3]))
ggplot(data = all_summary, aes(x=time,y=harvest.rate,col = age_code))+
geom_line()
require(ggplot2)
all_summary = data.frame(harvest.rate = mean.harv.matrix[1,],low = BI.low.harv.matrix[1,],high = BI.high.harv.matrix[1,],time = 1992:2008, group = age_code[1])
for(i in 2:4){
temp1 = data.frame(harvest.rate  = mean.harv.matrix[i,],low = BI.low.harv.matrix[i,],high = BI.high.harv.matrix[i,],time = 1992:2008, group = age_code[i])
all_summary <- rbind(temp1,all_summary)
}
all_summary[,1:3] <- 1/(1+exp(-all_summary[,1:3]))
ggplot(data = all_summary, aes(x=time,y=harvest.rate,col = group))+
geom_line()
ggplot(data = all_summary, aes(x=time,y=harvest.rate,col = group))+
geom_line()+
geom_errorbar(aes(ymin = low, ymax = high))
?geom_errorbar
ggplot(data = all_summary, aes(x=time,y=harvest.rate,col = group))+
geom_line()+
geom_errorbar(aes(ymin = low, ymax = high),size = .1)
ggplot(data = all_summary, aes(x=time,y=harvest.rate,col = group))+
geom_line()+
geom_errorbar(aes(ymin = low, ymax = high),size = .2)
write.csv(all_summary,"harvest_porp.csv",row.names = F)
ggsave("./harv_porp.pdf",width = 10,height = 8)
ggsave("./harv_porp.pdf",width = 10,height = 6, scale = 1.3)
ggsave("./harv_porp.pdf",width = 10,height = 6, scale = 2)
ggsave("./harv_porp.pdf",width = 10,height = 6, scale = .5)
ggsave("./harv_porp.pdf",width = 10,height = 6, scale = .8)
View(BI_harv_high)
187/11
lambda_MCMC <- matrix(NA, nrow = 2000, ncol = period-1)
i = 1
temp <- matrix(Chicago_RES$mcmc.objs$living.mcmc, ncol = period, byrow = T)
plot(colSums(temp))
temp <- matrix(Chicago_RES$mcmc.objs$living.mcmc[i,], ncol = period, byrow = T)
plot(colSums(temp))
temp <- matrix(Chicago_RES$mcmc.objs$living.mcmc[i,], ncol = period, byrow = F)
plot(colSums(temp))
for(i in 1:2000){
temp <- matrix(Chicago_RES$mcmc.objs$living.mcmc[i,], ncol = period, byrow = F)
temp <- colSums(temp)
lambda_MCMC[i,] <- temp[-1]/temp[-period]
}
plot(colMeans(temp))
plot(colMeans(lambda_MCMC))
mean.lambda = apply(lambda_MCMC,2,mean)
BI.low.lambda = apply(lambda_MCMC,2,quantile,probs = .025)
BI.high.lambda = apply(lambda_MCMC,2,quantile,probs = .975)
lambda_val <- data.frame(year = 1993:2008, lambda = mean.lambda, low = BI.low.lambda, high = BI.high.lambda)
write.csv(lambda_val, "lambda_summary.csv",row.names = F)
pp <- list()
lambda_val <- data.frame(year = 1993:2008, lambda = mean.lambda, lambda.low = BI.low.lambda, lambda.high = BI.high.lambda)
write.csv(lambda_val, "lambda_summary.csv",row.names = F)
pp <- list()
head(all_summary)
i = 1
temp <- all_summary[all_summary$group==age_code[i],]
temp
temp <- temp[temp$time!=1992,]
temp
temp <- cbind(temp,lambda_val)
temp
ggplot(data = temp, aes(x=harvest.rate,y=lambda))+
geom_line()+
geom_crossbar(aes(xmin=low,xmax = high, ymin = lambda.low,ymax = lambda.high))
ggplot(data = temp, aes(x=harvest.rate,y=lambda))+
geom_points()+
geom_crossbar(aes(xmin=low,xmax = high, ymin = lambda.low,ymax = lambda.high))
ggplot(data = temp, aes(x=harvest.rate,y=lambda))+
geom_point()+
geom_crossbar(aes(xmin=low,xmax = high, ymin = lambda.low,ymax = lambda.high))
ggplot(data = temp, aes(x=harvest.rate,y=lambda))+
geom_point()+
geom_errorbar(aes(xmin=low,xmax = high, ymin = lambda.low,ymax = lambda.high))+
geom_errorbarh(aes(xmin=low,xmax = high, ymin = lambda.low,ymax = lambda.high))
ggplot(data = temp, aes(x=harvest.rate,y=lambda))+
geom_point()+
geom_errorbar(aes(xmin=low,xmax = high, ymin = lambda.low,ymax = lambda.high),size = 0.4)+
geom_errorbarh(aes(xmin=low,xmax = high, ymin = lambda.low,ymax = lambda.high),size = 0.4)
ggplot(data = temp, aes(x=harvest.rate,y=lambda))+
geom_point()+
geom_errorbar(aes(xmin=low,xmax = high, ymin = lambda.low,ymax = lambda.high),size = 0.2)+
geom_errorbarh(aes(xmin=low,xmax = high),size = 0.2)
ggplot(data = temp, aes(x=harvest.rate,y=lambda))+
geom_point()+
geom_errorbar(aes(xmin=low,xmax = high, ymin = lambda.low,ymax = lambda.high),size = 0.2)+
geom_errorbarh(aes(xmin=low,xmax = high),size = 0.2)+
geom_smooth(method=lm)
ggplot(data = temp, aes(x=harvest.rate,y=lambda))+
geom_point()+
geom_errorbar(aes(xmin=low,xmax = high, ymin = lambda.low,ymax = lambda.high),size = 0.2)+
geom_errorbarh(aes(xmin=low,xmax = high),size = 0.2)+
geom_smooth(method=lm) +
geom_hline(yintercept = 1)
ggplot(data = temp, aes(x=harvest.rate,y=lambda))+
geom_point()+
geom_errorbar(aes(xmin=low,xmax = high, ymin = lambda.low,ymax = lambda.high),size = 0.2)+
geom_errorbarh(aes(xmin=low,xmax = high),size = 0.2)+
geom_smooth(method=lm) +
geom_hline(yintercept = 1)+
xlab(age_code[i])
pp_temp <- ggplot(data = temp, aes(x=harvest.rate,y=lambda))+
geom_point()+
geom_errorbar(aes(xmin=low,xmax = high, ymin = lambda.low,ymax = lambda.high),size = 0.2)+
geom_errorbarh(aes(xmin=low,xmax = high),size = 0.2)+
geom_smooth(method=lm) +
geom_hline(yintercept = 1,col = "red", type = 2)+
xlab(age_code[i])
ggplot(data = temp, aes(x=harvest.rate,y=lambda))+
geom_point()+
geom_errorbar(aes(xmin=low,xmax = high, ymin = lambda.low,ymax = lambda.high),size = 0.2)+
geom_errorbarh(aes(xmin=low,xmax = high),size = 0.2)+
geom_smooth(method=lm) +
geom_hline(yintercept = 1,col = "red", linetype = 2)+
xlab(age_code[i])
pp <- list()
for(i in 1:4){
temp <- all_summary[all_summary$group==age_code[i],]
temp <- temp[temp$time!=1992,]
temp <- cbind(temp,lambda_val)
pp_temp <- ggplot(data = temp, aes(x=harvest.rate,y=lambda))+
geom_point()+
geom_errorbar(aes(xmin=low,xmax = high, ymin = lambda.low,ymax = lambda.high),size = 0.2)+
geom_errorbarh(aes(xmin=low,xmax = high),size = 0.2)+
geom_smooth(method=lm) +
geom_hline(yintercept = 1,col = "red", linetype = 2)+
xlab(age_code[i])
pp[[i]] <- pp_temp
}
pp <- list()
for(i in 1:4){
temp <- all_summary[all_summary$group==age_code[i],]
temp <- temp[temp$time!=1992,]
temp <- cbind(temp,lambda_val)
pp_temp <- ggplot(data = temp, aes(x=harvest.rate,y=lambda))+
geom_point()+
geom_errorbar(aes(xmin=low,xmax = high, ymin = lambda.low,ymax = lambda.high),size = 0.2)+
geom_errorbarh(aes(xmin=low,xmax = high),size = 0.2)+
geom_smooth(method=lm) +
geom_hline(yintercept = 1,col = "red", linetype = 2)#+
#xlab(age_code[i])
pp[[i]] <- pp_temp
}
ggarrange(plotlist = pp, labels =age_code, label.x = 0.2)
library(ggpubr)
ggarrange(plotlist = pp, labels =age_code, label.x = 0.2)
pp <- list()
for(i in 1:4){
temp <- all_summary[all_summary$group==age_code[i],]
temp <- temp[temp$time!=1992,]
temp <- cbind(temp,lambda_val)
pp_temp <- ggplot(data = temp, aes(x=harvest.rate,y=lambda))+
geom_point()+
geom_errorbar(aes(xmin=low,xmax = high, ymin = lambda.low,ymax = lambda.high),size = 0.2)+
geom_errorbarh(aes(xmin=low,xmax = high),size = 0.2)+
#geom_smooth(method=lm) +
geom_hline(yintercept = 1,col = "red", linetype = 2)#+
#xlab(age_code[i])
pp[[i]] <- pp_temp
}
ggarrange(plotlist = pp, labels =age_code, label.x = 0.2)
?ggarrange
ggarrange(plotlist = pp, labels =age_code, label.x = 0.2,align = "hv")
ggarrange(plotlist = pp, labels =age_code, label.x = 0,align = "hv")
ggarrange(plotlist = pp, labels =age_code, label.x = 0.1,align = "hv")
ggsave("./rate_vs_lambda.pdf",width = 10, height = 8)
ggsave("./rate_vs_lambda.pdf",width = 12, height = 8, scale = .8)
